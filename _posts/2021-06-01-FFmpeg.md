---
layout: post
title:  "FFmpeg"
date:   2021-06-01 18:10:00 +0800
tags: ffmpeg
toc: true
---

[TOC]

## 硬编解码 qsv

1. `sudo docker run --privileged -it -v /home/zihao_wang:/mnt wzhy1234/ffmpeg-qsv /bin/bash`
2. 在容器内`# ffmpeg -i input -c:v hevc_qsv -global_quality 22 -tag:v hvc1 -look_ahead 1 out.mp4`

> [https://hub.docker.com/r/wzhy1234/ffmpeg-qsv](https://hub.docker.com/r/wzhy1234/ffmpeg-qsv)

## overlay字幕

```bash
-filter_complex "[0:v][0:s:3]overlay[v]" -map "[v]" -map 0:a:0
```
先编码1分钟测试一下
```bash
ffmpeg -y -ss 00:10:00 -i bluray:. -filter_complex "[0:v][0:s:3]overlay[v]" -map "[v]" -map 0:a:0 -c:a aac -b:a 256k -ac 2 -c:v libx264 -preset ultrafast  -t 00:01:00 /home/zihao_wang/test.mp4
```
测试成功后
```bash
ffmpeg -i bluray:. -filter_complex "[0:v][0:s:3]overlay[v]" -map "[v]" -map 0:a:0 -c:a aac -b:a 256k -ac 2 -c:v hevc_qsv -global_quality 22 -tag:v hvc1 -look_ahead 1 /mnt/out.mp4
```

## 视频拼接

先创建一个文本文件`filelist.txt`：
```
file 'input1.mkv'
file 'input2.mkv'
file 'input3.mkv'
```
然后：
`ffmpeg -f concat -i filelist.txt -c copy output.mkv`

## 中文字体方框

Glyph 0x5979 not found，说明找不到字怎么写
github上有一个仓库展示了这个glyph对应汉字列表
https://github.com/googlefonts/gftools/blob/main/Lib/gftools/encodings/chinese-simplified_unique-glyphs.nam

把字幕上传到ubuntu字体文件目录/root/.local/share/fonts/
然后刷新字体库 fc-cache -fv
然后把srt文件转为ass文件 ffmpeg -i 1.srt 1.ass
转完后，编辑ass文件，把字体改成微软雅黑/苹方
然后再用ass导入就行了`-vf ass="1.ass"`
[微软雅黑](/wryh.ttf)
[苹方](/PingFang.ttc)